{% extends "base.html" %}

{% block content %}
<h1 class="mb-4">Find Allergy-Free Recipes</h1>

<!-- Flash messages for errors, success, etc. -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- Show user's current allergen list -->
{% if user_allergens %}
  <div class="alert alert-secondary">
    <strong>Your allergens:</strong> {{ user_allergens | join(', ') }}
  </div>
{% endif %}

<!-- Search bar for entering a recipe keyword -->
<form method="POST" action="{{ url_for('recipe.index') }}" class="mb-4">
  <div class="input-group">
    <input 
      type="text" 
      name="query" 
      class="form-control" 
      placeholder="Search recipes by keyword or ingredient..." 
      required
      value="{{ query or '' }}"
    >
    <button class="btn btn-primary" type="submit">Search</button>
  </div>
</form>

<!-- Show error message if search fails -->
{% if error %}
  <div class="alert alert-warning mt-4">{{ error }}</div>
{% endif %}

<!-- Message when no safe recipes found -->
{% if not recipes and query and not error %}
  <div class="alert alert-info mt-4">
    No safe recipes were found matching your allergen preferences for "<strong>{{ query }}</strong>".
  </div>
{% endif %}

<!-- Display recipe search results -->
{% if recipes %}
  <p class="mb-3">Found {{ recipes|length }} allergy-safe recipes for "<strong>{{ query }}</strong>"</p>

  <div class="row row-cols-1 row-cols-md-3 g-4">
    {% for recipe in recipes %}
      <div class="col">
        <div class="card h-100 shadow rounded-4 border-0 card-hover-effect">
          
          <!-- Recipe image -->
          {% if recipe.image_url %}
            <img src="{{ recipe.image_url }}" class="card-img-top rounded-top-4" alt="{{ recipe.title }}">
          {% else %}
            <img src="{{ url_for('static', filename='img/placeholder.png') }}" class="card-img-top rounded-top-4" alt="No image available">
          {% endif %}
          
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ recipe.title }}</h5>

            <!-- Show cooking time -->
            {% if recipe.cooking_time %}
              <p class="card-text"><strong>Cooking time:</strong> {{ recipe.cooking_time }} mins</p>
            {% endif %}

            <!-- Show ingredients -->
            <p class="card-text ingredient-paragraph">
                {{ recipe.ingredients }}
            </p>

            <!-- Link to full recipe -->
            {% if recipe.recipe_url %}
              <a href="{{ recipe.recipe_url }}" class="btn btn-sm btn-outline-primary mt-auto" target="_blank" rel="noopener noreferrer">
                View Full Recipe
              </a>
            {% endif %}

            <!-- Save/Unsave button -->
            <button 
              class="btn btn-sm {{ 'btn-success' if recipe.is_saved else 'btn-outline-success' }} save-btn mt-2"
              data-recipe-id="{{ recipe.id }}"
              type="button"
            >
              {{ 'Saved' if recipe.is_saved else 'Save' }}
            </button>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
{% endif %}
{% endblock %}

<!-- Custom script block -->
{% block scripts %}
<script src="{{ url_for('static', filename='script.js') }}"></script>
{% endblock %}








